<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Редагування: <%= film.name %></title>
    <link rel="stylesheet" href="/css/styles.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body class="edit-page-body"> 
    <%- include('partials/header') %>
    <div class="menu-overlay" id="menu-overlay"></div>

    <main>
        <div class="container">
            
            <h2>Редагування фільму</h2>
            <p>Ви редагуєте: <strong><%= film.name %></strong></p>

            <div class="edit-container">
                <div class="edit-content" style="flex: 1; border: none;"> <form id="film-edit-form" method="POST" action="/film/<%= film.id %>/edit">
     
                        <form id="film-edit-form" method="POST" action="/film/<%= film.id %>/edit">
                            <div class="form-group span-all-columns">
                                <label for="poster_url">URL Постера (має починатись з https://)</label>
                                <input type="url" id="poster_url" name="poster_url" 
                                    value="<%= film.poster_url %>" 
                                    pattern="https://.*" 
                                    maxlength="200" 
                                    required>
                            </div>
                            
                            <div class="form-group span-all-columns">
                                <label for="description">Опис</label>
                                <textarea id="description" name="description" rows="8" 
                                        maxlength="2000"><%= film.description %></textarea>
                            </div>

                            <div class="form-group">
                                <label for="year_start">Рік (початок)</label>
                                <div class="select-wrapper">
                                    <select id="year_start" name="year_start">
                                        <% allYears.forEach(year => { %>
                                            <option value="<%= year %>" <%= (year == yearStart ? 'selected' : '') %>>
                                                <%= year %>
                                            </option>
                                        <% }); %>
                                    </select>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="year_end">Рік (кінець)</label>
                                <div class="select-wrapper">
                                    <select id="year_end" name="year_end">
                                        <% allYears.forEach(year => { %>
                                            <option value="<%= year %>" <%= (year == yearEnd ? 'selected' : '') %>>
                                                <%= year %>
                                            </option>
                                        <% }); %>
                                    </select>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="imdb_rating">Рейтинг IMDb</label>
                                <div class="select-wrapper">
                                    <select id="imdb_rating" name="imdb_rating">
                                        <option value="">Не вказано</option>
                                        <% imdbRatingList.forEach(rating => { %>
                                            <option value="<%= rating %>" <%= (film.imdb_rating == rating ? 'selected' : '') %>>
                                                <%= rating %>
                                            </option>
                                        <% }); %>
                                    </select>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="age_limit">Вікове обмеження (0-21)</label>
                                <input type="number" id="age_limit" name="age_limit" 
                                    value="<%= parseInt(film.age_limit) || 0 %>" 
                                    min="0" max="21"
                                    onkeydown="return false;">
                            </div>

                            <div class="form-group"> <label for="country">Країна</label>
                                <div class="select-wrapper">
                                    <select id="country" name="country">
                                        <option value="">Не вказано</option>
                                        <% allCountries.forEach(country => { %>
                                            <option value="<%= country %>" 
                                                <%= (film.country && film.country.includes(country) ? 'selected' : '') %>>
                                                <%= country %>
                                            </option>
                                        <% }); %>
                                    </select>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                            <div class="form-group"> <label for="duration">Тривалість (у хв)</label>
                                <input type="number" id="duration" name="duration" 
                                    value="<%= durationValue %>" 
                                    min="1" max="300"
                                    onkeydown="return false;">
                            </div>
                            <div class="filter-group multiselect-group span-2-columns" id="genre-multiselect-edit">
                                <label for="genre-trigger-edit">Жанри (оберіть до 7)</label>
                                <div class="multiselect-trigger" id="genre-trigger-edit" tabindex="0">
                                    <span>Оберіть жанри...</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="multiselect-panel" id="genre-panel-edit">
                                    <div class="filter-checkbox-list">
                                        <% if (locals.allGenres && allGenres.length > 0) { %>
                                            <% allGenres.forEach(genre => { %>
                                                <div class="checkbox-item">
                                                    <input 
                                                        type="checkbox" 
                                                        name="genre" 
                                                        id="edit-genre-<%= genre.genre_id %>" 
                                                        value="<%= genre.genre_id %>"
                                                        data-label="<%= genre.name %>"
                                                        <%= (currentGenreIds.includes(genre.genre_id) ? 'checked' : '') %>
                                                    >
                                                    <label for="edit-genre-<%= genre.genre_id %>">
                                                        <%= genre.name %>
                                                    </label>
                                                </div>
                                            <% }); %>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-button-group span-all-columns">
                                <button type="submit" class="auth-button">Зберегти зміни</button>
                                <a href="/film/<%= film.id %>" class="auth-button cancel-button">
                                    Скасувати
                                </a>
                            </div>
                        </form>
                        <div class="danger-zone">
                            <h3>Небезпечна зона</h3>
                            <p>Видалення фільму є незворотною дією. Всі дані про нього, ціни та оцінки користувачів будуть назавжди видалені.</p>
                            
                            <form id="delete-film-form" onsubmit="return false;"> <div class="form-group form-group-password">
                                    <label for="delete-film-password">Введіть ваш пароль для підтвердження:</label>
                                    <input type="password" id="delete-film-password" name="password" required>
                                    <i class="fas fa-eye-slash password-toggle-icon"></i>
                                </div>

                                <button type="button" class="auth-button danger-button" id="delete-film-btn" disabled>
                                    Видалити цей фільм
                                </button>
                                
                            </form>
                        </div>

                </div>
            </div>

        </div>
    </main>
    
    <%- include('partials/auth-modals') %>
    <div id="toast-container"></div>
    
    <script src="/js/main.js"></script>
    <script src="/js/film-edit.js"></script> 
</body>
</html>